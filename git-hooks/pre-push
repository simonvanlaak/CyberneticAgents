#!/usr/bin/env bash
set -euo pipefail

PYTHON_BIN="python3"
if [[ -x ".venv/bin/python" ]]; then
  PYTHON_BIN=".venv/bin/python"
fi
BASEDPYRIGHT_BIN="basedpyright"
if [[ -x ".venv/bin/basedpyright" ]]; then
  BASEDPYRIGHT_BIN=".venv/bin/basedpyright"
fi

echo "Running full test suite with coverage (min 70%)..."
${PYTHON_BIN} -m pytest tests/ -v --cov=src --cov-report=term-missing --cov-fail-under=70

echo "Running ruff on src/ and tests/..."
${PYTHON_BIN} -m ruff check src tests

echo "Running basedpyright on src/ and tests/..."
${BASEDPYRIGHT_BIN} --pythonpath ${PYTHON_BIN}
