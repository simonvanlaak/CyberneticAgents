# CyberneticAgents Docker image for CLI-based agent skills.
FROM node:22-slim

RUN apt-get update && apt-get install -y --no-install-recommends \
    ca-certificates \
    curl \
    git \
    jq \
    less \
    python3 \
    python3-pip \
    python3-venv \
    ripgrep \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Use a virtualenv to avoid PEP 668 externally-managed environment errors.
ENV VIRTUAL_ENV=/opt/venv
RUN python3 -m venv $VIRTUAL_ENV
ENV PATH="$VIRTUAL_ENV/bin:$PATH"

# Readability-based web fetch helper exposed as a CLI.
RUN python3 -m pip install --no-cache-dir \
    requests \
    git+https://github.com/buriy/python-readability.git
COPY src/tools/skills/web-fetch/web_fetch.py /usr/local/bin/web-fetch
RUN chmod +x /usr/local/bin/web-fetch

# Brave search CLI wrapper exposed as a CLI.
COPY src/tools/skills/web-search/web_search.py /usr/local/bin/web_search
RUN chmod +x /usr/local/bin/web_search

# File reader helper exposed as a CLI.
COPY src/tools/skills/file-reader/file_reader.py /usr/local/bin/file-reader
RUN chmod +x /usr/local/bin/file-reader

# Read-only git sync helper exposed as a CLI.
COPY src/tools/skills/git-readonly-sync/git_readonly_sync.py /usr/local/bin/git-readonly-sync
RUN chmod +x /usr/local/bin/git-readonly-sync

# Speech-to-text transcription helper exposed as a CLI.
COPY src/tools/skills/speech-to-text/speech_to_text.py /usr/local/bin/speech-to-text
RUN chmod +x /usr/local/bin/speech-to-text

# Message routing helper exposed as a CLI.
COPY src/tools/skills/message-routing/message_routing.py /usr/local/bin/message-routing
RUN chmod +x /usr/local/bin/message-routing

# Notion API helper exposed as a CLI.
COPY src/tools/skills/notion/notion_cli.py /usr/local/bin/notion
RUN chmod +x /usr/local/bin/notion

RUN git --version && rg --version

CMD ["bash"]
